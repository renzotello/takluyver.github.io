<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="assets/xml/rss.xsl" media="all"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>Codel</title><link>http://takluyver.github.io/</link><description>Thoughts about code</description><atom:link type="application/rss+xml" href="http://takluyver.github.io/rss.xml" rel="self"></atom:link><language>en</language><lastBuildDate>Sun, 16 Jul 2017 09:21:52 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>I can't import it!</title><link>http://takluyver.github.io/posts/i-cant-import-it.html</link><dc:creator>Thomas Kluyver</dc:creator><description>&lt;div&gt;&lt;p&gt;Have you installed a Python package, but now you can't import it?
Or can you import it when you run code one way,
but not when you run code another way?&lt;/p&gt;
&lt;p&gt;These are common problems, and this post is an attempt to explain what's
going on and how you can fix it.
If someone has sent you a link here, they're not trying to be rude:
we can help more people more effectively by sharing a detailed explanation
than by writing a short explanation each time.&lt;/p&gt;
&lt;div class="section" id="lots-of-pythons"&gt;
&lt;h2&gt;Lots of Pythons&lt;/h2&gt;
&lt;p&gt;There's probably more than one copy of Python on your computer.
When you run code in different ways, it might get run by different Pythons.
To see which Python is running your code, run:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_e3b7f58a3c3f4dd5841c7e7bad2b2ba0-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;a name="rest_code_e3b7f58a3c3f4dd5841c7e7bad2b2ba0-2"&gt;&lt;/a&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;executable&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;On my laptop, all of these are different Pythons (and they aren't all of them):&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;/usr/bin/python&lt;/tt&gt; (system Python 2)&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;/usr/bin/python3&lt;/tt&gt; (system Python 3)&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;/home/takluyver/miniconda3/bin/python&lt;/tt&gt; (Python in conda)&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;/home/takluyver/miniconda3/envs/py36/bin/python&lt;/tt&gt; (a separate conda environment)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each conda environment, virtualenv or pyenv you create is a separate Python.
But you can also have different names for the &lt;em&gt;same&lt;/em&gt; Python -- e.g.
&lt;tt class="docutils literal"&gt;/usr/bin/python3&lt;/tt&gt; is the same as &lt;tt class="docutils literal"&gt;/usr/bin/python3.5&lt;/tt&gt; on my laptop (it's
a 'symlink').&lt;/p&gt;
&lt;p&gt;Each Python installation or environment has its own package folder. When you
install a package, it's being installed for one particular Python, which might
not be the one you are trying to load it from.&lt;/p&gt;
&lt;p&gt;You can also see all of the places that &lt;tt class="docutils literal"&gt;import&lt;/tt&gt; will look for a module by
running:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_ceb81375faa04458a7ebc832d1ad95e0-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;a name="rest_code_ceb81375faa04458a7ebc832d1ad95e0-2"&gt;&lt;/a&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="what-can-i-do"&gt;
&lt;h2&gt;What can I do?&lt;/h2&gt;
&lt;p&gt;First, use the code above to find which Python is running your code.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Option 1&lt;/strong&gt;: Install the package for the same Python you're using.&lt;/p&gt;
&lt;p&gt;With pip, this is easy:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
path/to/python -m pip install some_package
&lt;/pre&gt;
&lt;p&gt;If you want to install it with conda, activate the conda environment
containing the Python you're using, and then run &lt;tt class="docutils literal"&gt;conda install some_package&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Option 2&lt;/strong&gt;: Switch to use a Python where the module you want is installed.&lt;/p&gt;
&lt;p&gt;It's hard to provide instructions for this, because it depends on the tools
you're using. If you're using an IDE, look in the settings. Here it is in
Pycharm, for instance:&lt;/p&gt;
&lt;img alt="/images/pycharm_interpreter_settings.png" class="align-center" src="http://takluyver.github.io/images/pycharm_interpreter_settings.png"&gt;
&lt;/div&gt;&lt;/div&gt;</description><guid>http://takluyver.github.io/posts/i-cant-import-it.html</guid><pubDate>Sun, 16 Jul 2017 08:42:52 GMT</pubDate></item><item><title>Understanding D-Bus</title><link>http://takluyver.github.io/posts/understanding-dbus.html</link><dc:creator>Thomas Kluyver</dc:creator><description>&lt;div&gt;&lt;p&gt;If you use desktop Linux, like I do, D-Bus is working behind the scenes to do
things like storing passwords and displaying notifications - and probably many
more things I'm not even aware of.&lt;/p&gt;
&lt;p&gt;I've run into D-Bus a couple of times, and found it confusing,
so I volunteered to do a short talk about it at &lt;a class="reference external" href="http://portsmouth.lug.org.uk/"&gt;Portsmouth LUG&lt;/a&gt;,
forcing myself to sit down and understand it.
I've come to like &lt;em&gt;parts&lt;/em&gt; of it,
and I even wrote a Python D-Bus interface called Jeepney.
But it's complicated, and I haven't found an explanation I like.
So this is what I think is worth understanding about D-Bus.
It's not a tutorial about how to use D-Bus, but if you've copied and pasted
D-Bus code from somewhere, it might help you use it better.&lt;/p&gt;
&lt;div class="section" id="it-s-about-messages"&gt;
&lt;h2&gt;It's about messages&lt;/h2&gt;
&lt;p&gt;D-Bus is a framework for different programs to communicate. That means they send
each other messages. Unfortunately, that simple idea gets a bit buried by the
Java-inspired, non-optional object-oriented layers on top of the messages.&lt;/p&gt;
&lt;p&gt;Guess which parts I still don't like.&lt;/p&gt;
&lt;p&gt;There are two messaging patterns on offer:&lt;/p&gt;
&lt;img alt="/images/dbus_methods_signals.png" class="align-center" src="http://takluyver.github.io/images/dbus_methods_signals.png"&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;strong&gt;Method calls&lt;/strong&gt; go to a single destination, and get a reply, which is either
a &lt;strong&gt;method return&lt;/strong&gt;, or an &lt;strong&gt;error&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Signals&lt;/strong&gt; are sent out to anyone who's interested, and there's no response.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;That's four message types in total, including returns and errors.
All four can carry data: different kinds of number,
UTF-8 strings, arrays and dictionaries,
and it's even possible to transfer a file descriptor in a D-Bus message.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The bus&lt;/strong&gt; is the hub that passes messages on to the right destinations. All
the other programs using D-Bus send and receive messages through the bus. You
can also send messages to the bus itself, to tell it who you are or to
subscribe to a signal.&lt;/p&gt;
&lt;p&gt;There are normally two buses available:
the &lt;em&gt;session bus&lt;/em&gt; is for your login (e.g. desktop notifications),
while the &lt;em&gt;system bus&lt;/em&gt; handles system-wide stuff (e.g. USB stick plugged in).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="names-names-names"&gt;
&lt;h2&gt;Names, names, names&lt;/h2&gt;
&lt;p&gt;To show a desktop notification, you'll send messages
to the object &lt;tt class="docutils literal"&gt;/org/freedesktop/Notifications&lt;/tt&gt;,
using the interface &lt;tt class="docutils literal"&gt;org.freedesktop.Notifications&lt;/tt&gt;,
on the bus name &lt;tt class="docutils literal"&gt;org.freedesktop.Notifications&lt;/tt&gt;.
Ugh. Why so many names?&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;bus name&lt;/strong&gt; is which program you're talking to. Each program that connects
to the bus gets a unique name automatically (like &lt;tt class="docutils literal"&gt;:1.247&lt;/tt&gt;).
It can then claim other names, like &lt;tt class="docutils literal"&gt;org.freedesktop.Notifications&lt;/tt&gt;.
The bus ensures that only one program has each name.
On my laptop, Gnome shell has claimed &lt;tt class="docutils literal"&gt;org.freedesktop.Notifications&lt;/tt&gt;,
along with many other names.&lt;/p&gt;
&lt;p&gt;If you send a message to a bus name which isn't claimed,
the bus may be able to start a program to handle it.
This is called &lt;em&gt;D-Bus activation&lt;/em&gt;,
and it's governed by simple files saying which program to start for which name.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;object path&lt;/strong&gt; refers to something inside the program which will handle the message.
For notifications, there's only one object to deal with: &lt;tt class="docutils literal"&gt;/org/freedesktop/Notifications&lt;/tt&gt;.
But the secrets API provided by Gnome keyring, for instance,
has an object for each secret stored, such as
&lt;tt class="docutils literal"&gt;/org/freedesktop/secrets/collections/login/2&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Finally, the &lt;strong&gt;interface&lt;/strong&gt; indicates which set of methods and signals are to be used with the object.
There's usually only one interface that's interesting for applications,
but most objects also have some standard interfaces like
&lt;tt class="docutils literal"&gt;org.freedesktop.DBus.Introspectable&lt;/tt&gt;, which you can use to examine the
methods and signals of an object.&lt;/p&gt;
&lt;p&gt;All these names start with reversed domain names,
so people don't accidentally use the same name for different things.
The examples I've given are defined by &lt;tt class="docutils literal"&gt;freedesktop.org&lt;/tt&gt;.
If I was defining my own D-Bus API, the names might look like
&lt;tt class="docutils literal"&gt;io.github.takluyver.projectname&lt;/tt&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="developer-tools"&gt;
&lt;h2&gt;Developer tools&lt;/h2&gt;
&lt;p&gt;There are a couple of nice tools available for investigating D-Bus:&lt;/p&gt;
&lt;img alt="D-Feet screenshot" class="screenshot align-center" src="http://takluyver.github.io/images/dfeet.png"&gt;
&lt;p&gt;&lt;em&gt;D-Feet&lt;/em&gt; shows you what D-Bus objects there are on your system,
the methods you can call and signals you can subscribe to.
It can also execute methods and show you the results, but this feels a bit clunky.&lt;/p&gt;
&lt;img alt="Bustle screenshot" class="screenshot align-center" src="http://takluyver.github.io/images/bustle.png"&gt;
&lt;p&gt;&lt;em&gt;Bustle&lt;/em&gt; records and shows messages being sent over D-Bus.
There's also a command line tool called &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;dbus-monitor&lt;/span&gt;&lt;/tt&gt; which serves a similar
purpose.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="other-details"&gt;
&lt;h2&gt;Other details&lt;/h2&gt;
&lt;p&gt;D-Bus uses Unix sockets, which are like network sockets but within one computer.
Unix sockets are pretty clever in their own right.
Each bus creates one Unix socket, and programs connect to it to talk to the bus.&lt;/p&gt;
&lt;p&gt;Actually, D-Bus can also run over network sockets, or a number of other transports.
Two processes can also use the protocol without a bus running.
This is all &lt;a class="reference external" href="https://dbus.freedesktop.org/doc/dbus-specification.html#transports"&gt;in the spec&lt;/a&gt;,
but the usual way to use D-Bus is with a bus and a Unix socket.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description><guid>http://takluyver.github.io/posts/understanding-dbus.html</guid><pubDate>Sat, 01 Jul 2017 17:16:35 GMT</pubDate></item><item><title>Why did I write yet another package manager?</title><link>http://takluyver.github.io/posts/why-did-i-write-yet-another-package-manager.html</link><dc:creator>Thomas Kluyver</dc:creator><description>&lt;div&gt;&lt;p&gt;&lt;strong&gt;Update July 2017&lt;/strong&gt;: Batis is no longer maintained. I think something like it
would have been great a few years earlier, but now I hope that &lt;a class="reference external" href="http://flatpak.org/"&gt;Flatpak&lt;/a&gt;
or &lt;a class="reference external" href="https://snapcraft.io/"&gt;Snaps&lt;/a&gt; will give us a better option for distributing
desktop applications.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://batis-installer.github.io/"&gt;Batis&lt;/a&gt; is a package manager for desktop applications on Linux.
Linux users are probably already used to using several different package managers -
apt, pip, npm, etc. - so why on earth do we need one more?&lt;/p&gt;
&lt;p&gt;Firstly, having many package managers is not a problem.
There are many different kinds of things we want to install.
Pip, for instance, knows how to install python packages;
if you want to install a ruby package, you'll need another tool.
The atom text editor includes a package manager, apm, purely for its own extensions,
and other extensible applications, like browsers, are quietly doing their own package management too.
You can try to build one package manager to rule them all, as Linux distros do,
but that system has to be more complex.
‘Do one thing well’ applies to package managers too.&lt;/p&gt;
&lt;p&gt;The best way to distribute desktop applications on Linux at present is through distro repositories.
The idea is that power users from each distro who like your application will prepare packages,
making it easily available for other users of the same distro.
But this has several drawbacks for application developers:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;You’re not in control of your distribution channels -
if a distro doesn’t like your app, they can block their users’ easy access to it.&lt;/li&gt;
&lt;li&gt;Feature releases of your app are tied to releases of the entire distro.
Launch version 2.0 at the wrong time, and even the keen Ubuntu users who
update on release day it comes out won’t see your new features for six months.
Some users will be stuck on old versions for &lt;em&gt;years&lt;/em&gt;.
There are exceptions, but this is the norm in the major Linux distributions.&lt;/li&gt;
&lt;li&gt;If you want to bypass the distros and host your own repositories,
you have to deal with several different packaging systems -
at a minimum, .deb and .rpm packages. Desktop Linux is a small market anyway,
and this fragmentation makes it even more painful to target.&lt;/li&gt;
&lt;li&gt;Your install instructions either have to be vague,
or contain a table of commands for different distros
(like &lt;a class="reference external" href="http://play0ad.com/download/linux/"&gt;0 A.D.&lt;/a&gt; or &lt;a class="reference external" href="https://git-cola.github.io/downloads.html"&gt;git-cola&lt;/a&gt;).
Neither is ideal for less technical users.&lt;/li&gt;
&lt;li&gt;Distro packages can usually only be installed as root.
This often doesn’t matter for desktop use, where the user is usually the owner of the computer,
but it can be an annoying restriction.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The tools for packaging modules in many programming languages can also be used to
package command line applications. You've probably seen utilities that you install
using pip (e.g. &lt;a class="reference external" href="https://getnikola.com/getting-started.html"&gt;Nikola&lt;/a&gt;),
npm (&lt;a class="reference external" href="http://bower.io/#install-bower"&gt;bower&lt;/a&gt;),
or gem (&lt;a class="reference external" href="https://jekyllrb.com/"&gt;Jekyll&lt;/a&gt;).
But these tools don't know about creating menu entries or file associations, so
they're not great for distributing graphical applications.&lt;/p&gt;
&lt;p&gt;Many applications forgo all of these packaging mechanisms,
and distribute tarballs or zip files from their own website (e.g.
&lt;a class="reference external" href="http://powdertoy.co.uk/"&gt;Powder Toy&lt;/a&gt;,
&lt;a class="reference external" href="https://www.jetbrains.com/pycharm/download/#linux"&gt;PyCharm&lt;/a&gt;,
&lt;a class="reference external" href="https://code.visualstudio.com/"&gt;Visual Studio Code&lt;/a&gt;).
This is the starting point for Batis.
Batis adds a consistent way to install and uninstall applications, so that developers
can focus on their applications, not on rewriting Linux install code.
A Batis package is a regular tarball with some extra files, so there’s no need
to build another tarball for users without Batis.
You even get a free &lt;tt class="docutils literal"&gt;install.sh&lt;/tt&gt; script inside your package for those users to run.&lt;/p&gt;
&lt;p&gt;Batis adds one extra layer above tarball downloads, the index file.
This is a JSON file containing the URLs of the tarballs for download,
along with some basic metadata.
Batis uses this to select the best build to install -
for instance if you have separate builds for 64 bit and 32 bit systems.
In future versions, the index will also be used to check for updates to installed applications.&lt;/p&gt;
&lt;p&gt;So, &lt;strong&gt;Batis is&lt;/strong&gt; a distro-agnostic way for users to get applications directly
from developers. It works with the standard mechanisms to integrate applications
into the desktop environment. And it's an evolutionary improvement on distributing
plain tarballs.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://batis-installer.github.io/"&gt;Batis website&lt;/a&gt;—for more information&lt;/p&gt;&lt;/div&gt;</description><guid>http://takluyver.github.io/posts/why-did-i-write-yet-another-package-manager.html</guid><pubDate>Fri, 20 Nov 2015 13:06:47 GMT</pubDate></item><item><title>So you want to write a desktop app in Python</title><link>http://takluyver.github.io/posts/so-you-want-to-write-a-desktop-app-in-python.html</link><dc:creator>Thomas Kluyver</dc:creator><description>&lt;div&gt;&lt;p&gt;This is an overview of the best tools and the best resources for building
desktop applications in Python.&lt;/p&gt;
&lt;p&gt;First things first. You can build great desktop applications in Python, and some
are widely used (like Dropbox). But you'll have to find your own way much more
than you would using Microsoft's or Apple's SDKs. The upside is that, with a bit
of legwork to package it appropriately, it's quite feasible to write a Python
application that works on all the major platforms.&lt;/p&gt;
&lt;div class="section" id="gui-toolkits"&gt;
&lt;h2&gt;GUI toolkits&lt;/h2&gt;
&lt;p&gt;The first thing you'll need to choose is a GUI toolkit.&lt;/p&gt;
&lt;img alt="Qt logo" class="align-right" src="http://takluyver.github.io/images/QtLogo.png"&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;For traditional desktop UIs, &lt;strong&gt;Qt&lt;/strong&gt; is a clear winner. It's powerful, looks
native on all the major platforms, and has probably the biggest community.
There are two different Python bindings: &lt;a class="reference external" href="http://www.riverbankcomputing.com/software/pyqt/intro"&gt;PyQt&lt;/a&gt;
is older and more mature, but it's only free if your application is open source
(&lt;a class="reference external" href="http://www.riverbankcomputing.com/software/pyqt/license"&gt;licensing&lt;/a&gt;), while
&lt;a class="reference external" href="http://qt-project.org/wiki/PySide"&gt;PySide&lt;/a&gt; is newer and more permissively
licensed (LGPL). I refer to the &lt;a class="reference external" href="http://qt-project.org/doc/"&gt;main Qt docs&lt;/a&gt;
a lot - the C++ examples mostly translate to Python quite well - but both &lt;a class="reference external" href="http://pyqt.sourceforge.net/Docs/PyQt4/index.html"&gt;PyQt's&lt;/a&gt; and &lt;a class="reference external" href="http://qt-project.org/wiki/PySideDocumentation"&gt;PySide's docs&lt;/a&gt; contain some useful information.
&lt;a class="reference external" href="http://qt-project.org/doc/qt-4.8/designer-manual.html"&gt;Qt Designer&lt;/a&gt; is
a drag and drop interface to design your UI; you can compile its .ui files
to Python modules with the pyuic command line tool.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="figure"&gt;
&lt;img alt="/images/Qt_Designer.png" src="http://takluyver.github.io/images/Qt_Designer.png"&gt;
&lt;p class="caption"&gt;Qt Designer in action&lt;/p&gt;
&lt;/div&gt;
&lt;img alt="Kivy logo" class="align-right" src="http://takluyver.github.io/images/kivy-logo.png" style="height: 64px;"&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;For attractive, tablet-style interfaces, &lt;strong&gt;Kivy&lt;/strong&gt; is the
right choice. It's a fairly young but promising system. If you want to bring
your application to tablets and smartphones, then Kivy is the only option
that I'm aware of. &lt;a class="reference external" href="http://kivy.org/"&gt;More info&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;When you want a basic GUI and don't care about aesthetics, &lt;strong&gt;Tkinter&lt;/strong&gt; is a
simple option. It's installed as part of Python. Python's own &lt;a class="reference external" href="https://docs.python.org/3/library/tkinter.html"&gt;tkinter documentation&lt;/a&gt; is rather minimal, but it
links to a bunch of other resources. &lt;a class="reference external" href="http://effbot.org/tkinterbook/"&gt;This site&lt;/a&gt;
is my favourite - it hasn't been updated in years, but then neither has Tkinter
(except that in Python 3, you &lt;tt class="docutils literal"&gt;import tkinter&lt;/tt&gt; rather than &lt;tt class="docutils literal"&gt;import Tkinter&lt;/tt&gt;).&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://pygame.org/"&gt;pygame&lt;/a&gt; is popular for building simple 2D games. There
are also frameworks for 3D graphics (&lt;a class="reference external" href="http://www.pyglet.org/"&gt;pyglet&lt;/a&gt;,
&lt;a class="reference external" href="https://www.panda3d.org/"&gt;Panda3d&lt;/a&gt;), but I don't know much about them.&lt;/li&gt;
&lt;li&gt;An increasingly popular option is to write your application as a local web
server, and build the UI in HTML and Javascript. This lets you use Python's
large ecosystem of web frameworks and libraries, but it's harder to integrate
with desktop conventions for things like opening files and window management.
&lt;a class="reference external" href="https://code.google.com/p/cefpython/"&gt;CEF Python&lt;/a&gt; lets you make a window
for your application, based on Google Chrome, but I haven't tried that.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A couple of alternatives I wouldn't recommend unless you have a reason to prefer
them: &lt;strong&gt;GTK&lt;/strong&gt; is popular on Linux, but it
looks ugly on other platforms. The older &lt;a class="reference external" href="http://www.pygtk.org/"&gt;pygtk&lt;/a&gt;
bindings have excellent documentation; the newer &lt;a class="reference external" href="https://wiki.gnome.org/Projects/PyGObject"&gt;PyGObject&lt;/a&gt;
system, which supports recent versions of GTK and Python, doesn't (though it's
getting better). &lt;strong&gt;wx&lt;/strong&gt; seems to have a good community, but development is slow,
and new projects that could have used it now mostly seem to pick Qt.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="packaging-and-distribution"&gt;
&lt;h2&gt;Packaging and Distribution&lt;/h2&gt;
&lt;p&gt;This is probably the roughest part of making an application in Python. You can
easily distribute tools for developers as Python packages to be installed using
pip, but end users don't generally have Python and pip already set up. Python
packages also can't depend on something like Qt. There are a number of ways to
package your application and its dependencies:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://pynsist.readthedocs.org/"&gt;Pynsist&lt;/a&gt;, my own project, makes
a Windows installer which installs a version of Python that you specify, and
then installs your application. Unlike the other tools listed here, it doesn't
try to 'freeze' your application into an exe, but makes shortcuts which launch
.py files. This avoids certain kinds of bugs.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://cx-freeze.sourceforge.net/"&gt;cx_Freeze&lt;/a&gt; is a freeze tool:
it makes an executable out of your application. It works on Windows, Mac and
Linux, but only produces the executable for the platform you run it on (you
can't make a Windows exe on Linux, for example).
It can make simple packages (.msi for Windows, .dmg for Mac, .rpm for Linux),
or you can feed its output into &lt;a class="reference external" href="http://nsis.sourceforge.net/"&gt;NSIS&lt;/a&gt; or
&lt;a class="reference external" href="http://www.jrsoftware.org/isinfo.php"&gt;Inno Setup&lt;/a&gt; to have more control over
building a Windows installer.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.pyinstaller.org/"&gt;PyInstaller&lt;/a&gt; is similar to cx_Freeze.
It doesn't yet support Python 3 (update: it does now, since October 2015),
but it does have the ability to produce a 'single file' executable.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://pythonhosted.org/py2app/"&gt;py2app&lt;/a&gt; is a freeze tool specifically
for building Mac .app bundles.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.py2exe.org/"&gt;py2exe&lt;/a&gt; is a Windows-only freeze tool.
Development stopped for a long time, but at the time of writing there is some
recent activity on it.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="section" id="linux-packaging"&gt;
&lt;h3&gt;Linux packaging&lt;/h3&gt;
&lt;p&gt;Although some of the freeze tools can build Linux binaries, the preferred way to
distribute software is to make a package containing just your application, which
has &lt;em&gt;dependencies&lt;/em&gt; on Python and the libraries your application uses. So your
package doesn't contain everything it needs, but it tells the package manager
what other pieces it needs installed.&lt;/p&gt;
&lt;p&gt;Unfortunately, the procedures for preparing these are pretty complex, and Linux
distributions still don't have a common package format. The main ones are deb
packages, used by Debian, Ubuntu and Mint, and rpm packages, used by Fedora and
Red Hat. I don't know of a good, simple guide to packaging Python applications
for either - if you find one or write one, let me know.&lt;/p&gt;
&lt;p&gt;You can get users to download and install your package, but if you want it to
receive updates through the package manager, you'll need to host it in a
repository. Submitting your package to the distribution's main repositories makes
it easiest for users to install, but it has to meet the distro's quality
standards, and you generally can't push new feature releases to people except when
they upgrade the whole distribution. Some distributions offer hosting for
personal repos: Ubuntu's PPAs, or Fedora's Fedorapeople repositories. You can
also set up a repository on your own server.&lt;/p&gt;
&lt;p&gt;If you don't want to think about all that, just make a tarball of your application,
and explain to Linux users next to the download what it requires.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="miscellaneous"&gt;
&lt;h2&gt;Miscellaneous&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Threading&lt;/strong&gt;: If your application does anything taking longer than about a tenth
of a second, you should do it in a background thread, so your UI doesn't freeze
up. Be sure to only interact with GUI elements from the main thread, or you
can get segfaults. Python's GIL isn't a big issue here: the UI thread shouldn't
need much Python processing time.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Updates&lt;/strong&gt;: &lt;a class="reference external" href="https://pypi.python.org/pypi/esky"&gt;Esky&lt;/a&gt; is a framework for
updating frozen Python applications. I haven't tried it, but it looks interesting.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;</description><guid>http://takluyver.github.io/posts/so-you-want-to-write-a-desktop-app-in-python.html</guid><pubDate>Mon, 16 Jun 2014 23:55:03 GMT</pubDate></item><item><title>ASTsearch - code searching that knows about code</title><link>http://takluyver.github.io/posts/astsearch-code-searching-that-knows-about-code.html</link><dc:creator>Thomas Kluyver</dc:creator><description>&lt;div&gt;&lt;p&gt;This weekend's hack is a tool for searching Python code.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/takluyver/astsearch"&gt;ASTsearch source code on Github&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;What's wrong with grep, you might ask? Let's try to find every division in
IPython's codebase:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ grep --include "*.py" -rF "/" .
config/loader.py:        after applying any insert / extend / update changes
config/configurable.py:                    # ConfigValue is a wrapper for using append / update on containers
config/tests/test_loader.py:        argv = ['--a=~/1/2/3', '--b=~', '--c=~/', '--d="~/"']
config/tests/test_loader.py:        self.assertEqual(config.a, os.path.expanduser('~/1/2/3'))
config/tests/test_loader.py:        self.assertEqual(config.c, os.path.expanduser('~/'))
config/tests/test_loader.py:        self.assertEqual(config.d, '~/')
...
&lt;/pre&gt;
&lt;p&gt;In all, it finds 1685 lines, and very few of them are actual division. You could
write a regex that tries to ignore comments and strings, but &lt;a class="reference external" href="http://regex.info/blog/2006-09-15/247"&gt;now you have two
problems&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Let's do the same with ASTsearch:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ astsearch "?/?"
core/oinspect.py
 646|        shalf = int((string_max -5)/2)

core/ultratb.py
1254|        return h / i

core/page.py
 347|        whalf = int((width -5)/2)
...
&lt;/pre&gt;
&lt;p&gt;The output is 89 lines, and when spacing and filenames are removed, there are
46 results, all of which represent division operations.&lt;/p&gt;
&lt;p&gt;In this case, grep produced a lot of false positives. In other cases, it will
have false negatives—results that you wanted but didn't find. &lt;tt class="docutils literal"&gt;a=1&lt;/tt&gt; won't
match &lt;tt class="docutils literal"&gt;a= 1&lt;/tt&gt;, and &lt;tt class="docutils literal"&gt;"this"&lt;/tt&gt; won't match &lt;tt class="docutils literal"&gt;'this'&lt;/tt&gt;. For simple cases, regexes
can help (&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;a\s*=\s*1&lt;/span&gt;&lt;/tt&gt;), but they soon get unwieldy. ASTsearch is insensitive
to how you format your code: even statements split over several lines are easy
to find.&lt;/p&gt;
&lt;div class="section" id="how-does-it-work"&gt;
&lt;h2&gt;How does it work?&lt;/h2&gt;
&lt;p&gt;The string pattern—&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;?/?&lt;/span&gt;&lt;/tt&gt; in the example above—is turned into an AST pattern.
ASTs, or Abstract Syntax Trees, are a structured representation of a formal
language such as Python source code.&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;?&lt;/tt&gt; is a wildcard, so &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;?/?&lt;/span&gt;&lt;/tt&gt; means "anything divided by anything". I picked
&lt;tt class="docutils literal"&gt;?&lt;/tt&gt; for this because it's not used in Python syntax, so it doesn't stop you
writing more specific search patterns.&lt;/p&gt;
&lt;p&gt;Some more patterns:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;a = ?&lt;/tt&gt; - Something is assigned to &lt;tt class="docutils literal"&gt;a&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;class &lt;span class="pre"&gt;?(TemplateExporter):&lt;/span&gt; ?&lt;/tt&gt; - A subclass of TemplateExporter&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;for ? in &lt;span class="pre"&gt;?:&lt;/span&gt; ? \nelse: ?&lt;/tt&gt; - A for loop with an &lt;tt class="docutils literal"&gt;else&lt;/tt&gt; clause&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then it walks the directory, parsing each file with a &lt;tt class="docutils literal"&gt;.py&lt;/tt&gt; extension using
Python's built in parser. The standard library &lt;a class="reference external" href="https://docs.python.org/3/library/ast.html"&gt;ast module&lt;/a&gt; contains the tools to parse the
code and walk the AST, and &lt;a class="reference external" href="https://pypi.python.org/pypi/astcheck"&gt;astcheck&lt;/a&gt;,
another tool I wrote, can compare AST nodes against a template.&lt;/p&gt;
&lt;p&gt;Besides the command line interface, you can also use ASTsearch as a Python
module (&lt;tt class="docutils literal"&gt;import astsearch&lt;/tt&gt;). It's possible to define complex search patterns
in Python code that can't be written at the command line. &lt;a class="reference external" href="http://astsearch.readthedocs.org/en/latest/api.html"&gt;See the docs&lt;/a&gt; for some more details.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="what-s-the-catch"&gt;
&lt;h2&gt;What's the catch?&lt;/h2&gt;
&lt;p&gt;ASTsearch only works on Python files, and Python files that are entirely valid
syntax (that's Python 3 syntax for now). If just the last line can't be parsed,
it won't find any matches in that file.&lt;/p&gt;
&lt;p&gt;It's slower than grep, because what it's doing is much more complex, and grep is
&lt;a class="reference external" href="http://lists.freebsd.org/pipermail/freebsd-current/2010-August/019310.html"&gt;highly optimised&lt;/a&gt;.
But Python's parser is doing most of the hard work, and that's written in C. On
my laptop, scanning the IPython codebase (about 100k lines of code) takes about
3.5 seconds—definitely not instant, but far faster than I can think about even a
couple of results.&lt;/p&gt;
&lt;p&gt;There are search patterns you can't express at the command line. For instance,
you can't match function calls with a specific number of arguments (but you can
find function &lt;em&gt;definitions&lt;/em&gt; with a given number of arguments: &lt;tt class="docutils literal"&gt;def &lt;span class="pre"&gt;?(?,&lt;/span&gt; &lt;span class="pre"&gt;?):&lt;/span&gt; ?&lt;/tt&gt;).
I might extend the pattern mini-language once I've got a feel for what would be
useful.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-do-i-install-it"&gt;
&lt;h2&gt;How do I install it?&lt;/h2&gt;
&lt;pre class="literal-block"&gt;
pip install astsearch
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description><guid>http://takluyver.github.io/posts/astsearch-code-searching-that-knows-about-code.html</guid><pubDate>Sun, 27 Apr 2014 17:39:44 GMT</pubDate></item><item><title>Readable Python coroutines</title><link>http://takluyver.github.io/posts/readable-python-coroutines.html</link><dc:creator>Thomas Kluyver</dc:creator><description>&lt;div&gt;&lt;p&gt;Quick exercise: write a piece of code that, each time you pass it a word (a
string), tells you if you've passed it that word before. If you're reading a
post with a title like this, it shouldn't take you more than a few minutes. For
bonus points, have an option to ignore case, so it counts 'parrot' and 'Parrot'
as the same word.&lt;/p&gt;
&lt;p&gt;What did you go for? A function with a global variable (yuck!)? A class with a
method? A closure?&lt;/p&gt;
&lt;p&gt;How about a coroutine? Here's what that would look like:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-1"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;have_seen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;case_sensitive&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-2"&gt;&lt;/a&gt;    &lt;span class="n"&gt;seen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-3"&gt;&lt;/a&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-4"&gt;&lt;/a&gt;    &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-5"&gt;&lt;/a&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-6"&gt;&lt;/a&gt;        &lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-7"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;case_sensitive&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-8"&gt;&lt;/a&gt;            &lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lower&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-10"&gt;&lt;/a&gt;        &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;seen&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_5c71758631a24f028345e03f3fc81b9b-11"&gt;&lt;/a&gt;        &lt;span class="n"&gt;seen&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;And here's how you would use it:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; hs = have_seen()
&amp;gt;&amp;gt;&amp;gt; next(hs)  # prime it
&amp;gt;&amp;gt;&amp;gt; hs.send('Hello')
False
&amp;gt;&amp;gt;&amp;gt; hs.send('World')
False
&amp;gt;&amp;gt;&amp;gt; hs.send('hello')
True
&lt;/pre&gt;
&lt;p&gt;Coroutines in Python are based on the generator machinery - see the &lt;tt class="docutils literal"&gt;yield&lt;/tt&gt;
keyword in there? &lt;a class="reference external" href="http://www.python.org/dev/peps/pep-0342/"&gt;PEP 342&lt;/a&gt;,
"Coroutines via Enhanced Generators", added the necessary features to Python
2.5, but it's not a very well known part of the language. And it's not hard to
see why - the code above isn't as clear as it should be:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Emitting and receiving a value happen in the same yield expression. So rather
than yielding the response at the bottom of the loop, we have to store it in a
variable and jump back to the top of the loop.&lt;/li&gt;
&lt;li&gt;The coroutine has to emit a value before it can receive one, even though
there's nothing it really wants to emit. That's why we set &lt;tt class="docutils literal"&gt;res = None&lt;/tt&gt;
before the loop, and why the caller has to prime it by calling &lt;tt class="docutils literal"&gt;next(hs)&lt;/tt&gt;
before using it. It's easy to write a decorator that calls &lt;tt class="docutils literal"&gt;next&lt;/tt&gt; for you,
but that doesn't make the code inside the coroutine any clearer.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So the standard Python syntax is rather awkward. But we can make it clearer by
using a bit of wrapper code.
The trick is separating sending a value from receiving one:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;coromagic&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;coroutine&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-3"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@coroutine&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;have_seen2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;case_sensitive&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-5"&gt;&lt;/a&gt;    &lt;span class="n"&gt;seen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-7"&gt;&lt;/a&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-8"&gt;&lt;/a&gt;        &lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-9"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;case_sensitive&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-10"&gt;&lt;/a&gt;            &lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lower&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-11"&gt;&lt;/a&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-12"&gt;&lt;/a&gt;        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;seen&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_f29a2f4497f54b49a5a17b2991954630-13"&gt;&lt;/a&gt;        &lt;span class="n"&gt;seen&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;We no longer need the &lt;cite&gt;res&lt;/cite&gt; variable. Instead, we alternate between two uses of
yield: a receiving yield, where we send the wrapper a token to indicate that
we're ready for a new value, and a sending yield, where we don't expect to get a
value back. The caller can use this in exactly the same way as the original
coroutine, except that the wrapper primes it automatically, so there's no need
to call &lt;tt class="docutils literal"&gt;next(hs)&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;The wrapper expects a receiving yield first, and at most one sending yield after
each receiving yield. If a receiving yield is followed by another receiving
yield, without a sending yield inbetween, &lt;tt class="docutils literal"&gt;None&lt;/tt&gt; is returned to the caller,
just like a function without a return statement.&lt;/p&gt;
&lt;div class="section" id="handling-exceptions"&gt;
&lt;h2&gt;Handling exceptions&lt;/h2&gt;
&lt;p&gt;If either of our coroutines above raises an exception, we can't keep using that
coroutine:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; hs.send(12)
Traceback (most recent call last):
  File "&amp;lt;stdin&amp;gt;", line 1, in &amp;lt;module&amp;gt;
  File "coro_ideas.py", line 8, in have_seen
    word = word.lower()
AttributeError: 'int' object has no attribute 'lower'
&amp;gt;&amp;gt;&amp;gt; hs.send('hi')
Traceback (most recent call last):
  File "&amp;lt;stdin&amp;gt;", line 1, in &amp;lt;module&amp;gt;
StopIteration
&lt;/pre&gt;
&lt;p&gt;I've got a solution of sorts for that, although it still feels a bit awkward.
The coroutine can request a context manager to catch exceptions:&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;coromagic&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;get_exception_context&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-3"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@coroutine&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-4"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;have_seen3&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;case_sensitive&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-5"&gt;&lt;/a&gt;    &lt;span class="n"&gt;exception_context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;get_exception_context&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-6"&gt;&lt;/a&gt;    &lt;span class="n"&gt;seen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-7"&gt;&lt;/a&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-8"&gt;&lt;/a&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-9"&gt;&lt;/a&gt;        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;exception_context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-10"&gt;&lt;/a&gt;            &lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-11"&gt;&lt;/a&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;case_sensitive&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-12"&gt;&lt;/a&gt;                &lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lower&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-13"&gt;&lt;/a&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-14"&gt;&lt;/a&gt;            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;word&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;seen&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_55569be39d16466b9bd0daf53f9b97da-15"&gt;&lt;/a&gt;            &lt;span class="n"&gt;seen&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;word&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;The context manager co-ordinates with the wrapper to suppress the exception inside the coroutine, but raise it to the caller:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt;&amp;gt;&amp;gt; hs3 = have_seen3()
&amp;gt;&amp;gt;&amp;gt; hs3.send(12)
Traceback (most recent call last):
  File "&amp;lt;stdin&amp;gt;", line 1, in &amp;lt;module&amp;gt;
  File "./coromagic.py", line 28, in send
    raise self.last_exc
  File "./coro_ideas.py", line 47, in have_seen3
    word = word.lower()
AttributeError: 'int' object has no attribute 'lower'
&amp;gt;&amp;gt;&amp;gt; hs3.send('hi')
False
&lt;/pre&gt;
&lt;p&gt;Now the error doesn't stop us processing valid input afterwards.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="who-cares-about-coroutines"&gt;
&lt;h2&gt;Who cares about coroutines?&lt;/h2&gt;
&lt;p&gt;I find them interesting on their own. But this isn't just academic -
there are cases where coroutines can be the clearest way to write something.&lt;/p&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;have_seen&lt;/tt&gt; example could easily be written with a class or a closure.
Coroutines come into their own for making state machines. With a class or a
closure, the state has to be stored in a variable, and you need a lookup table
to decide how to behave in each state. A coroutine can store the state as the
point where its code is executing.&lt;/p&gt;
&lt;p&gt;It's hard to come up with an example of this that's both realistic and
short, but here's my attempt. We're writing a plugin for a chat
application, which lets any chatter say "password foo", silencing everyone until
someone guesses "foo". The application just passes us each message, and expects
a True/False response saying whether it should be broadcast.&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-1"&gt;&lt;/a&gt;&lt;span class="nd"&gt;@coroutine&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-2"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;password_game&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-3"&gt;&lt;/a&gt;    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-4"&gt;&lt;/a&gt;        &lt;span class="c"&gt;# Normal chatting&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-5"&gt;&lt;/a&gt;        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-6"&gt;&lt;/a&gt;            &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-7"&gt;&lt;/a&gt;            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;startswith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"password "&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-8"&gt;&lt;/a&gt;                &lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-9"&gt;&lt;/a&gt;                &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-10"&gt;&lt;/a&gt;                &lt;span class="k"&gt;break&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-11"&gt;&lt;/a&gt;            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;  &lt;span class="c"&gt;# Broadcast&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-12"&gt;&lt;/a&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-13"&gt;&lt;/a&gt;        &lt;span class="c"&gt;# Waiting for someone to guess the password&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-14"&gt;&lt;/a&gt;        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-15"&gt;&lt;/a&gt;            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt; &lt;span class="c"&gt;# Don't send messages&lt;/span&gt;
&lt;a name="rest_code_eafa5d7297754f00b0b67933b78c9f8a-16"&gt;&lt;/a&gt;        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;   &lt;span class="c"&gt;# Show everyone the password once it has been guessed&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;In IPython, we have some coroutines for input processing. For instance, the
transformer to strip prompts from pasted code processes the first two lines in a
prompt-detection state. Then it moves into a prompt-stripping state if it
detected a prompt, or a no-op state if it didn't.&lt;/p&gt;
&lt;p&gt;The pattern of sending and receiving is also reminiscent of writing a thread
with input and output queues, and waiting for values on those queues. But
threads are messy: you have to deal with synchronisation and shut them
down safely. Calling a cororoutine is as deterministic as calling a function:
it runs, returns a value, and the calling code carries on. Of course, that means
that coroutines themselves don't run in parallel. But you can use them to build
clever things like &lt;a class="reference external" href="http://code.google.com/p/tulip/"&gt;tulip&lt;/a&gt;, which will become
the &lt;tt class="docutils literal"&gt;asyncio&lt;/tt&gt; module in Python 3.4. Tulip can suspend one coroutine and run
others while it waits for data, and then resume it when the data it needs is
ready.&lt;/p&gt;
&lt;p&gt;The best resource on coroutines in Python is &lt;a class="reference external" href="http://dabeaz.com/coroutines/"&gt;this excellent course&lt;/a&gt; by David Beazley.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="coromagic-source-code"&gt;
&lt;h2&gt;Coromagic source code&lt;/h2&gt;
&lt;p&gt;This is the module used in the examples above.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://takluyver.github.io/listings/coromagic.py.html"&gt;coromagic.py&lt;/a&gt;&lt;/p&gt;
&lt;pre class="code python"&gt;&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;functools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;wraps&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-3"&gt;&lt;/a&gt;&lt;span class="c"&gt;# Tokens&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-4"&gt;&lt;/a&gt;&lt;span class="n"&gt;receive&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-5"&gt;&lt;/a&gt;&lt;span class="n"&gt;get_exception_context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-6"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-7"&gt;&lt;/a&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CoroutineWrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-8"&gt;&lt;/a&gt;    &lt;span class="n"&gt;last_exc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-9"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-10"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-11"&gt;&lt;/a&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;generator&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-12"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-13"&gt;&lt;/a&gt;        &lt;span class="n"&gt;ready&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gen&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-14"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ready&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;get_exception_context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-15"&gt;&lt;/a&gt;            &lt;span class="n"&gt;ready&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gen&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ExceptionContext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-16"&gt;&lt;/a&gt;        &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;ready&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-17"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-18"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-19"&gt;&lt;/a&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_exc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-20"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-21"&gt;&lt;/a&gt;        &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gen&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-22"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-23"&gt;&lt;/a&gt;            &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-24"&gt;&lt;/a&gt;        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-25"&gt;&lt;/a&gt;            &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gen&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-26"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-27"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_exc&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-28"&gt;&lt;/a&gt;            &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_exc&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-29"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-30"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;res&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-31"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-32"&gt;&lt;/a&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;coroutine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;genfunc&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-33"&gt;&lt;/a&gt;    &lt;span class="sd"&gt;"""Decorator for a generator function to wrap it as a coroutine."""&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-34"&gt;&lt;/a&gt;    &lt;span class="nd"&gt;@wraps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;genfunc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-35"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapped&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-36"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;CoroutineWrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;genfunc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-37"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-38"&gt;&lt;/a&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapped&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-39"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-40"&gt;&lt;/a&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ExceptionContext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-41"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;corowrapper&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-42"&gt;&lt;/a&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;corowrapper&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;corowrapper&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-43"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-44"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__enter__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-45"&gt;&lt;/a&gt;        &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-46"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-47"&gt;&lt;/a&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__exit__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-48"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-49"&gt;&lt;/a&gt;            &lt;span class="k"&gt;return&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-50"&gt;&lt;/a&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ne"&gt;GeneratorExit&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-51"&gt;&lt;/a&gt;            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-52"&gt;&lt;/a&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-53"&gt;&lt;/a&gt;        &lt;span class="c"&gt;# Pass other exceptions to the wrapper, and silence them for now&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-54"&gt;&lt;/a&gt;        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;corowrapper&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_exc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;
&lt;a name="rest_code_8e0c3779a2ef4a4f957826960c7b04bd-55"&gt;&lt;/a&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</description><guid>http://takluyver.github.io/posts/readable-python-coroutines.html</guid><pubDate>Sun, 10 Nov 2013 14:28:51 GMT</pubDate></item></channel></rss>